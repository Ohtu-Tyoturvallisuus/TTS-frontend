# Guide to EAS Build, Submit, and Update Scripts

In this project, we use Expo Application Services (EAS) for building, submitting, and updating the app. Below are detailed instructions on how each script works and when to use them.

### Prerequisites

Before running the scripts, ensure you have the following installed and configured:
- **Node.js** and **npm** installed.
- [**Expo**](https://expo.dev/signup) account and [**Apple Developer Program**](https://developer.apple.com/programs/) account are required for app submission.
- The necessary credentials and permissions set up for iOS builds in your Expo account.

You can view and modify these scripts directly in the `package.json` file under the `scripts` section.

For further guidance on using EAS, visit the official Expo documentation here: [Expo Guide Overview](https://docs.expo.dev/guides/overview/).

> **Note:** EAS Build and EAS Submit are automated in our GitHub Actions workflow. You can find the workflow configuration here: [**CD(iOS)-HazardHunt**](https://github.com/Ohtu-Tyoturvallisuus/TTS-frontend/blob/main/.github/workflows/eas-build-submit-ios.yml).

---

## Build, Submit, and Update Scripts

### 1. Build for iOS (Production)

**Script:**

```bash
npm run build:ios:production
```

**Description:**

This script builds the iOS app using **EAS Build** with the `production` profile specified in the EAS configuration file (`eas.json`). It also uses the `dotenv` CLI to load environment variables before running the build.

- **Command explanation:**
    - `npx dotenv --`: Loads environment variables using `dotenv-cli`.
    - `npx eas-cli build --platform ios --profile production`: Builds the iOS app using the production profile from `eas.json`.

**When to use:**

Use this script when you want to build the iOS app for production, including when preparing for App Store submission or testing on TestFlight.

### 2. Submit iOS Build to the App Store

**Script:**

```bash
npm run submit:ios
```

**Description:**

This script submits the **latest iOS build** to the App Store Connect using **EAS Submit**. It fetches the most recent build artifacts generated by EAS and uploads them to Apple.

> **Important:** For EAS Submit to work, ensure that your `eas.json` file contains valid values for `appleId`, `ascAppId`, and `appleTeamId`. These fields might be set to `"intentionally_left_blank"` for security reasons and should be updated with real values manually. Also, remember to **avoid pushing real credentials** to GitHub by keeping your sensitive information secure and excluding it from version control.

- **Command explanation:**
    - `npx eas-cli submit --platform ios --latest --profile production`: Submits the latest iOS build for the production profile to the App Store.

**When to use:**

Use this script after building your iOS app to submit it directly to the App Store for review. This is essential when you are ready to release a new version or update an existing one.

### 3. Update iOS via EAS Update (OTA)

**Script:**

```bash
npm run update:ios -- --message "Your update message"
```

**Description:**

This script pushes over-the-air (OTA) updates to users on the **production branch** using **EAS Update**. You need to add `-- --message "Your update message"` after the script. This flag is **mandatory** and describes the update for version control and tracking. You need to provide a clear and descriptive message every time you run the update (this flag is mandatory).

- **Command explanation:**
    - `npx eas-cli update --branch production`: Sends updates to the users on the `production` branch.
    - `--message "Your update message"`: Describes the update for version control and tracking.

**When to use:**

Use this script when you want to push minor updates, such as UI changes or bug fixes, to users **without needing to rebuild** the entire app and submit it to the App Store. These updates will be applied the next time users open the app.

---

### Example Usage Scenarios

1. **Building and submitting your iOS app:**

   After making changes to your app, run:

   ```bash
   npm run build:ios:production
   ```

   Once the build is complete, submit it to the App Store:

   ```bash
   npm run submit:ios
   ```

2. **Sending OTA updates without a full rebuild:**

   For small updates, you can push changes over-the-air. For example:

   ```bash
   npm run update:ios -- --message "Fixed layout issues on the home screen"
   ```

---

> **Note:** When updating the values in your `eas.json` file, remember to keep real values **from being pushed to GitHub** to avoid exposing sensitive credentials.

---